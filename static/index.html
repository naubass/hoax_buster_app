<!DOCTYPE html>
<html lang="id" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TruthLens AI - Multimodal Hoax Buster</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    fontFamily: { sans: ['"Plus Jakarta Sans"', 'sans-serif'], mono: ['"JetBrains Mono"', 'monospace'] },
                    colors: { ai: { dark: '#0f172a', card: '#1e293b' } },
                    animation: { 'blob': 'blob 7s infinite', 'fade-in': 'fadeIn 0.5s ease-out forwards' },
                    keyframes: {
                        blob: { '0%': { transform: 'translate(0px, 0px) scale(1)' }, '33%': { transform: 'translate(30px, -50px) scale(1.1)' }, '66%': { transform: 'translate(-20px, 20px) scale(0.9)' }, '100%': { transform: 'translate(0px, 0px) scale(1)' } },
                        fadeIn: { '0%': { opacity: '0', transform: 'translateY(10px)' }, '100%': { opacity: '1', transform: 'translateY(0)' } }
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar { width: 8px; } ::-webkit-scrollbar-track { background: #0f172a; } ::-webkit-scrollbar-thumb { background: #334155; border-radius: 4px; }
        .glass-panel { background: rgba(30, 41, 59, 0.7); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.1); }
        .text-gradient { background: linear-gradient(to right, #60a5fa, #a78bfa, #f472b6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        #resultContent ul { list-style: none; padding: 0; } #resultContent a { word-break: break-word; } #resultContent strong, #resultContent b { color: white; font-weight: 600; }
        /* Hide default file input */
        input[type="file"] { display: none; }
    </style>
</head>
<body class="bg-ai-dark text-slate-200 min-h-screen relative overflow-x-hidden selection:bg-indigo-500 selection:text-white">
    <div class="fixed inset-0 z-0 pointer-events-none overflow-hidden">
        <div class="absolute top-0 left-1/4 w-96 h-96 bg-purple-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob"></div>
        <div class="absolute top-0 right-1/4 w-96 h-96 bg-blue-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-2000"></div>
        <div class="absolute -bottom-32 left-1/3 w-96 h-96 bg-pink-500 rounded-full mix-blend-multiply filter blur-3xl opacity-20 animate-blob animation-delay-4000"></div>
    </div>

    <div class="relative z-10 container mx-auto px-4 py-12 flex flex-col items-center justify-center min-h-screen">
        <div class="text-center mb-10 space-y-4">
            <div class="inline-flex items-center gap-2 px-3 py-1 rounded-full bg-slate-800/50 border border-slate-700 text-xs font-medium text-blue-400 mb-2">
                <span class="relative flex h-2 w-2"><span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-blue-400 opacity-75"></span><span class="relative inline-flex rounded-full h-2 w-2 bg-blue-500"></span></span>
                Powered by Llama 3.2 Vision & LangGraph
            </div>
            <h1 class="text-5xl md:text-6xl font-bold tracking-tight">Truth<span class="text-gradient">Lens</span> AI</h1>
            <p class="text-slate-400 text-lg max-w-xl mx-auto leading-relaxed">Verifikasi fakta dari teks atau <span class="text-blue-400 font-semibold">screenshot/gambar</span> menggunakan AI Multimodal.</p>
        </div>

        <div class="w-full max-w-3xl glass-panel rounded-2xl shadow-2xl shadow-black/50 p-1">
            <div class="bg-slate-900/50 rounded-xl p-6 md:p-8">
                <div class="space-y-4">
                    
                    <div class="relative group bg-slate-800/50 rounded-xl border border-slate-700 focus-within:border-blue-500 focus-within:ring-1 focus-within:ring-blue-500 transition-all">
                        <textarea id="questionInput" rows="3" 
                            class="w-full bg-transparent text-white p-4 pb-12 focus:outline-none placeholder:text-slate-600 resize-none font-sans text-lg rounded-xl"
                            placeholder="Ketik klaim di sini, atau upload gambar..."></textarea>
                        
                        <div class="absolute bottom-3 left-3 right-3 flex justify-between items-center">
                             <div id="fileNameDisplay" class="text-xs text-blue-400 italic truncate max-w-[60%]"></div>
                             <label for="imageInput" class="cursor-pointer p-2 bg-slate-700 hover:bg-slate-600 text-slate-300 hover:text-white rounded-lg transition-all flex items-center gap-2 text-sm">
                                <i data-lucide="image-plus" class="w-4 h-4"></i> Upload Gambar
                            </label>
                            <input type="file" id="imageInput" accept="image/*" onchange="handleFileSelect(event)">
                        </div>
                    </div>

                    <button onclick="checkHoax()" id="submitBtn" class="w-full relative group overflow-hidden bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white font-semibold py-4 px-6 rounded-xl transition-all duration-200 shadow-lg shadow-blue-900/30">
                        <span class="relative z-10 flex items-center justify-center gap-2 text-lg"><i data-lucide="sparkles" class="w-5 h-5"></i> Mulai Investigasi</span>
                    </button>
                </div>

                <div id="loadingArea" class="hidden mt-8 border-t border-slate-700/50 pt-6 animate-fade-in">
                    <div class="flex items-center justify-between mb-4"><span class="text-sm font-mono text-green-400 tracking-wide flex items-center gap-2"><div class="w-2 h-2 bg-green-500 rounded-full animate-pulse"></div> AI AGENT ACTIVE</span></div>
                    <div class="bg-black/40 rounded-lg p-4 font-mono text-sm border border-slate-800/50 h-40 overflow-y-auto" id="logsContainer"></div>
                </div>

                <div id="resultArea" class="hidden mt-8 animate-fade-in">
                    <div id="captureArea" class="relative overflow-hidden rounded-xl border border-slate-700 bg-slate-900 p-1">
                        <div class="absolute top-0 left-0 right-0 h-1 bg-gradient-to-r from-blue-500 via-purple-500 to-pink-500"></div>
                        <div class="p-6 md:p-8 bg-slate-800/80">
                            <div class="flex items-center justify-between mb-6 border-b border-slate-700 pb-4">
                                <div class="flex items-center gap-3"><div class="p-2 bg-blue-500/10 rounded-lg text-blue-400"><i data-lucide="file-check" class="w-6 h-6"></i></div><h2 class="text-xl font-bold text-white">Laporan Investigasi</h2></div>
                                <div class="text-right"><h3 class="text-lg font-bold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-purple-400">TruthLens AI</h3><p class="text-[10px] text-slate-500 uppercase tracking-widest">Fact Check Report</p></div>
                            </div>
                            <div id="resultContent" class="text-slate-300 leading-relaxed font-sans space-y-4"></div>
                            <div class="mt-8 pt-4 border-t border-slate-700/50 text-center"><p class="text-xs text-slate-500">Diverifikasi secara otomatis oleh AI â€¢ Cek kebenaran di TruthLens</p></div>
                        </div>
                    </div>
                    <div class="mt-6 flex flex-col md:flex-row gap-3 justify-end">
                        <button onclick="downloadImage()" class="flex-1 md:flex-none text-white bg-green-600 hover:bg-green-500 px-5 py-2.5 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-all shadow-lg shadow-green-900/20"><i data-lucide="download" class="w-4 h-4"></i> Download / Share</button>
                        <button onclick="resetUI()" class="flex-1 md:flex-none text-slate-300 bg-slate-700 hover:bg-slate-600 px-5 py-2.5 rounded-lg text-sm font-medium flex items-center justify-center gap-2 transition-all"><i data-lucide="refresh-cw" class="w-4 h-4"></i> Analisis Baru</button>
                    </div>
                </div>
            </div>
        </div>
        <footer class="mt-12 text-slate-500 text-sm">&copy; 2025 TruthLens AI. Multimodal Edition.</footer>
    </div>

    <script>
        lucide.createIcons();
        let selectedFile = null;

        // Fungsi saat file dipilih
        function handleFileSelect(event) {
            const fileInput = event.target;
            const fileNameDisplay = document.getElementById('fileNameDisplay');
            if (fileInput.files.length > 0) {
                selectedFile = fileInput.files[0];
                // Tampilkan nama file dan ikon gambar
                fileNameDisplay.innerHTML = `<i data-lucide="image" class="w-3 h-3 inline mr-1"></i> ${selectedFile.name}`;
                lucide.createIcons(); // Refresh icon
                document.getElementById('questionInput').placeholder = "Gambar terpilih. Klik 'Mulai Investigasi'...";
            } else {
                selectedFile = null;
                fileNameDisplay.innerText = '';
                document.getElementById('questionInput').placeholder = "Ketik klaim di sini, atau upload gambar...";
            }
        }

        async function checkHoax() {
            const question = document.getElementById('questionInput').value;
            
            // Validasi: Harus ada teks ATAU gambar
            if (!question.trim() && !selectedFile) {
                alert("Mohon masukkan teks atau upload gambar!"); return;
            }

            // UI Loading start
            const btn = document.getElementById('submitBtn');
            const loadingArea = document.getElementById('loadingArea');
            const resultArea = document.getElementById('resultArea');
            const logsContainer = document.getElementById('logsContainer');
            const resultContent = document.getElementById('resultContent');
            btn.disabled = true;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-5 h-5 animate-spin"></i> Memproses...`;
            lucide.createIcons();
            loadingArea.classList.remove('hidden');
            resultArea.classList.add('hidden');
            logsContainer.innerHTML = ''; 

            // --- PERUBAHAN PENTING DI SINI: Menggunakan FormData ---
            const formData = new FormData();
            if (question.trim()) {
                formData.append('question', question);
            }
            if (selectedFile) {
                formData.append('image', selectedFile); // Kunci 'image' harus sama dengan di backend
            }

            try {
                // Fetch API sekarang mengirim FormData, bukan JSON
                const response = await fetch('http://localhost:8000/analyze', {
                    method: 'POST',
                    // Jangan set Content-Type header secara manual saat pakai FormData, browser akan mengaturnya otomatis
                    body: formData 
                });

                const data = await response.json();

                if (data.status === 'success') {
                    for (let log of data.logs) {
                        const div = document.createElement('div');
                        div.className = "text-slate-400 mb-1";
                        // Highlight log vision
                        if(log.includes("Vision")) {
                            div.innerHTML = `> <span class="text-blue-400 font-semibold">${log}</span>`;
                        } else {
                            div.innerHTML = `> ${log}`;
                        }
                        logsContainer.appendChild(div);
                        logsContainer.scrollTop = logsContainer.scrollHeight;
                        await new Promise(r => setTimeout(r, 400));
                    }
                    resultContent.innerHTML = data.final_answer;
                    loadingArea.classList.add('hidden');
                    resultArea.classList.remove('hidden');
                } else { alert("Gagal memproses permintaan: " + (data.detail || "Unknown error")); }
            } catch (error) { console.error(error); alert("Gagal menghubungi server backend. Cek koneksi atau ukuran file."); } 
            finally {
                btn.disabled = false;
                btn.innerHTML = `<i data-lucide="sparkles" class="w-5 h-5"></i> Mulai Investigasi`;
                lucide.createIcons();
            }
        }

        function downloadImage() {
            const captureElement = document.getElementById('captureArea');
            const btn = event.currentTarget;
            const originalText = btn.innerHTML;
            btn.innerHTML = `<i data-lucide="loader-2" class="w-4 h-4 animate-spin"></i> Menyimpan...`;
            lucide.createIcons();
            html2canvas(captureElement, { backgroundColor: "#0f172a", scale: 2, logging: false, useCORS: true }).then(canvas => {
                const link = document.createElement('a');
                link.download = 'TruthLens-Investigation-' + Date.now() + '.jpg';
                link.href = canvas.toDataURL('image/jpeg', 0.9);
                link.click();
                btn.innerHTML = originalText;
                lucide.createIcons();
            }).catch(err => { console.error(err); alert("Gagal menyimpan gambar."); btn.innerHTML = originalText; lucide.createIcons(); });
        }

        function resetUI() {
            document.getElementById('questionInput').value = '';
            document.getElementById('imageInput').value = ''; // Reset input file
            selectedFile = null;
            document.getElementById('fileNameDisplay').innerText = '';
            document.getElementById('questionInput').placeholder = "Ketik klaim di sini, atau upload gambar...";
            document.getElementById('resultArea').classList.add('hidden');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>